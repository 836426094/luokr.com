window.L=window.L||{},L.config=L.config||{},L.method=L.method||{},L.string=L.string||{},L.widget=L.widget||{},L.string.TIMEOUT="操作超时！",L.string.SUCCESS="操作成功！",L.string.FAILURE="操作失败！",L.string.WAITING="处理中，请稍侯...",L.string.LOADING="加载中，请稍侯...",L.string.POSTING="发送中，请稍侯...",L.string.CONFIRM="确认执行该操作吗？",L.method.date=function(e,t){var a=t?new Date(t):new Date,r=a.getTime();return(""+e).replace(/a|A|d|D|F|g|G|h|H|i|I|j|l|L|m|M|n|s|S|t|T|U|w|y|Y|z|Z/g,function(e){switch(e){case"a":return a.getHours()>11?"pm":"am";case"A":return a.getHours()>11?"PM":"AM";case"d":return("0"+a.getDate()).slice(-2);case"D":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][a.getDay()];case"F":return["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()];case"g":return(t=a.getHours()||12)>12?t-12:t;case"G":return a.getHours();case"h":return("0"+((t=a.getHours()||12)>12?t-12:t)).slice(-2);case"H":return("0"+a.getHours()).slice(-2);case"i":return("0"+a.getMinutes()).slice(-2);case"I":return function(){return a.setDate(1),a.setMonth(0),t=[a.getTimezoneOffset()],a.setMonth(6),t[1]=a.getTimezoneOffset(),a.setTime(r),t[0]==t[1]?0:1}();case"j":return a.getDate();case"l":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()];case"L":return(t=a.getFullYear())%4!=0||t%100==0&&t%400!=0?0:1;case"m":return("0"+(a.getMonth()+1)).slice(-2);case"M":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][a.getMonth()];case"n":return a.getMonth()+1;case"s":return("0"+a.getSeconds()).slice(-2);case"S":return["th","st","nd","rd"][(t=a.getDate())<4?t:0];case"t":return function(){return a.setDate(32),t=32-a.getDate(),a.setTime(r),t}();case"T":return"UTC";case"U":return(""+r).slice(0,-3);case"w":return a.getDay();case"y":return(""+a.getFullYear()).slice(-2);case"Y":return a.getFullYear();case"z":return function(){return a.setMonth(0),a.setTime(r-a.setDate(1))/864e5}();default:return 60*-a.getTimezoneOffset()}})},L.method.nl2br=function(e,t){return e.replace(/\r\n/g,"\n").replace(/[\r\n]/g,void 0===t?"<br>":t)},L.method.htext=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},L.method.confirm=function(e){return confirm(void 0===e?L.string.CONFIRM:e)},L.method.prepare=function(e){var t={display:L.widget.display,message:L.string.WAITING};$.extend(t,e||{}),t.display.render({hold:!0,mode:"wait",body:t.message})},L.method.request=function(e){var t={element:null,prepare:L.method.prepare,respond:L.method.respond,success:L.method.success,failure:L.method.failure};if($.extend(t,e||{}),!t.element)return t._action&&$.ajax({url:t._action,type:t._method||"get",data:t._params||"",dataType:t._format||"json",beforeSend:function(e){t.prepare(t)===!1&&e.abort()},success:function(e){t.success(t,e)},error:function(e,a){t.failure(t,e,a)}}),!1;if(t.element=$(t.element),t.element.is("form")){var a=t.element;a.ajaxSubmit({dataType:"json",beforeSend:function(e){t.prepare(t)===!1&&e.abort()},success:function(e){t.success(t,e),L.widget.captcha.reload(a.find(".captcha"))},error:function(e,a){t.failure(t,e,a)}})}else{var r=t.element;$.ajax({url:r.attr("href")||r.data("href"),type:"get",dataType:"json",beforeSend:function(e){t.prepare(t)===!1&&e.abort()},success:function(e){t.success(t,e)},error:function(e,a){t.failure(t,e,a)}})}return!1},L.method.success=function(e,t){var a={respond:L.method.respond};$.extend(a,e||{}),a.respond(e,t)},L.method.respond=function(e,t){var a={display:L.widget.display,forward:!0};$.extend(a,e||{});var r=[];null!=t.msg&&""!=t.msg&&r.push(t.sta?t.sta+" "+t.msg:t.msg),t.err?(a.forward&&t.url&&r.push('放弃操作，请 <a href="'+t.url+'">点击这里</a>'),a.display.render({mode:"warn",head:L.string.FAILURE,body:r.length?r.join("<br/>"):L.string.FAILURE})):(a.forward&&r.push(t.url?'继续操作，请 <a href="'+t.url+'">点击这里</a>':'继续操作，请 <a href="javascript:location.reload()">刷新当前页</a> 或 <a href="javascript:history.go(-1)">返回上一页</a>'),a.display.render({head:L.string.SUCCESS,body:r.length?r.join("<br/>"):L.string.SUCCESS}))},L.method.failure=function(e,t,a){var r={respond:L.method.respond};$.extend(r,e||{});var n={err:1,sta:0,msg:"",url:"",dat:{}};if("error"==a||"parsererror"==a){var d=$.parseJSON(t.responseText);d?n=d:(n.sta=t.status,n.msg=t.statusText)}else"timeout"==a&&(n.sta=504,n.msg=L.string.TIMEOUT);r.respond(e,n)},L.method.operate=function(e,t,a,r){return L.method.request({_method:e,_action:t,_params:a,_format:r}),!1},L.widget.display={},L.widget.display.locate=function(e){var t={uqid:""};$.extend(t,e||{});var a=$('.dial[data-id="dial'+t.uqid+'"]');if(!a.size()){var r='<div data-id="dial'+t.uqid+'" class="modal hide fade dial" tabindex="-1" role="dialog" aria-hidden="true">    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>    <div class="modal-header dial-head"></div>    <div class="modal-body dial-body"></div>    <div class="modal-footer dial-foot"></div></div>';$("body").append(r),a=$(a.selector)}return a},L.widget.display.render=function(e){var t={mode:"",head:"",body:"",foot:"",hold:!1};$.extend(t,e||{});var a=L.widget.display.locate(e);a.data("bind")||(a.data("bind",!0),a.on("hide",function(){return!$(this).data("hold")})),a.data("mode")&&(a.removeClass("dial-mode-"+a.data("mode")),a.data("mode","")),t.mode&&(a.data("mode",t.mode),a.addClass("dial-mode-"+a.data("mode"))),a.data("hold",t.hold?!0:!1),t.hold?a.find(".close").hide():a.find(".close").show(),a.find(".dial-head").html(t.head),""==t.head?a.find(".dial-head").hide():a.find(".dial-head").show(),a.find(".dial-body").html(t.body),""==t.body?a.find(".dial-body").hide():a.find(".dial-body").show(),a.find(".dial-foot").html(t.foot),""==t.foot?a.find(".dial-foot").hide():a.find(".dial-foot").show(),a.is(":hidden")&&a.modal("show")},L.widget.display.remove=function(e){var t={stay:0};$.extend(t,e||{});var a=L.widget.display.locate(e);a.size()&&!a.is(":hidden")&&(t.stay>0?setTimeout(function(){a.modal("hide")},t.stay):a.modal("hide"))},L.widget.captcha={},L.widget.captcha.create=function(e){if(e=$(e),e.hasClass("captcha")&&!e.find(".captcha-form").size()){var t='<div class="captcha-form">    <div class="captcha-btns">        <a href="javascript:;" class="captcha-btns-reload" title="获取新的验证" onclick="L.widget.captcha.reload(this);"></a>        <a href="javascript:;" class="captcha-btns-whatis" title="输入验证码有助于我们识别当前是否机器操作"></a>    </div>    <div class="captcha-show">        <a href="javascript:;" onclick="L.widget.captcha.reload(this);" title="获取新的验证"><img onload="L.widget.captcha.onload(this);" src="/check.jpeg?form='+(e.data("form")||"")+"&time="+(new Date).getTime()+'"></a>    </div>    <div class="captcha-main">        <input type="text" class="captcha-code" name="_code" autocomplete="off" placeholder="输入验证码">        <input type="hidden" name="_form" value="'+(e.data("form")||"")+'">    </div></div>';e.html(t)}},L.widget.captcha.onload=function(e){e=$(e).closest(".captcha"),e.size()&&(e.find(".captcha-code").focus().select(),e.find(".captcha-form").removeClass("captcha-proc-reload"))},L.widget.captcha.reload=function(e){e=$(e).closest(".captcha"),e.size()&&(e.find(".captcha-form").addClass("captcha-proc-reload"),e.find(".captcha-show img").attr("src","/check.jpeg?form="+(e.data("form")||"")+"&time="+(new Date).getTime()))},$(function(){$("body").data("exts-scrollup")&&$.scrollUp({scrollName:"scrollUp",topDistance:"300",topSpeed:300,animation:"fade",animationInSpeed:200,animationOutSpeed:200,scrollText:"",activeOverlay:!1}),$("body").data("exts-autohidingnavbar")&&$(".navbar-fixed-top").autoHidingNavbar({showOnBottom:!1}),$(".require-confirm").on("click",function(){return L.method.confirm()}),$(".request-ajax-link, .request-ajax-link-with-confirm").on("click",function(){return(!$(this).hasClass("request-ajax-link-with-confirm")||L.method.confirm())&&L.method.request({element:this}),!1}),$(".request-ajax-form, .request-ajax-form-with-confirm").on("submit",function(){if(!$(this).hasClass("request-ajax-form-with-confirm")||L.method.confirm()){if(window.CKEDITOR)for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();L.method.request({element:this})}return!1})});
